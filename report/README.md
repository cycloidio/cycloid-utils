# Reports

Scripts used to provide useful debug report to the Cycloid team.

# Contribution

Global functions are located under `source/common.sh`.
Please use the `generate.sh` script to update `generated/*_report.sh` ones.

```
./generate.sh
```

# Details

* **worker_report.sh**: Generate report from Concourse worker and provide a URL + secret.
* **onprem_report.sh**: Generate report from Cycloid onprem setup and provide a URL + secret.
* **getreport.sh**: Get report from provided URL + secret.

## worker_report.sh

The script generate a full report of a Concourse worker.

**functions list**

|Name|Description|parameters|sensitive|
|---|---|---|---|
|`agreement`|Cycloid information and question regarding sensitive datas.|`false`|`false`|
|`systemctl_debug`|Worker services details.|`concourse-worker.service, var-lib-concourse-datas.mount`|`false`|
|`mount_debug`|Mounted volume (container datas).|``|`false`|
|`ps_debug`|Processus running.|``|`false`|
|`system_debug`|System information like uptime or uname.|``|`false`|
|`curl_tsa`|Curl on concourse TSA server.|``|`false`|
|`curl_url`|Curl on website.|`https://github.com github.com`|`false`|
|`access_port`| Validate access on host/port (github ssh).|`github.com 22`|`false`|
|`network_debug`| Network informations (ip/route/resolv...).|``|`false`|
|`worker_status`| Concourse worker health-check.|``|`false`|
|`var_log_debug`| Get /var/log/<logname>.|`user-data.log concourse-worker.log syslog`|`false`|
|`extra_files_debug`| Copy extra files worker script and pub key.|`/var/lib/concourse/concourse-worker /var/lib/concourse/host_key.pub`|`false`|
|`extra_files_debug`| Copy worker private key.|`/var/lib/concourse/worker_key`|`true`|
|`validate_rsa_key`| Validate private key rsa format.|``|`false`|
|`send_report`| Send report.|``|`false`|


### Usage
```
curl -sSL https://raw.githubusercontent.com/cycloidio/cycloid-utils/master/report/generated/worker_report.sh | sudo bash
```


## onprem_report.sh

The script generate a full report of a Cycloid on-premise setup.

**functions list**

|Name|Description|parameters|sensitive|
|---|---|---|---|
|`agreement`|Cycloid information and question regarding sensitive datas.|`false`|`false`|
|`systemctl_debug`|Cycloid and concourse services.|`cycloid-api_container.service, cycloid-db_container.service, cycloid-frontend_container.service, cycloid-redis_container.service, cycloid-smtp_container.service, concourse-db_container.service, concourse-web_container.service, vault_container.service`|`false`|
|`mount_debug`|Mounted volume (container datas).|``|`false`|
|`ps_debug`|Processus running.|``|`false`|
|`system_debug`|System information like uptime or uname.|``|`false`|
|`network_debug`| Network informations (ip/route/resolv...).|``|`false`|
|`curl_url`|Curl on cycloid, concourse service and github.|`80/3001/8080/8888/8443/8200`|`false`|
|`access_port`| Validate access on cycloid, concourse and github ports.|`3306/6379/1025/8025/5432/2222`|`false`|
|`docker_debug`| Docker details (service/ps/images...).|``|`false`|
|`var_log_debug`| Get /var/log/<logname>.|`syslog nginx/cycloid-api-access.log nginx/cycloid-api-error.log`|`false`|
|`extra_files_debug`| Copy extra files nginx configs.|`/etc/nginx/sites-enabled/01-cycloid-console.conf /etc/nginx/sites-enabled/02-cycloid-api.conf /etc/nginx/conf.d/01-proxy.conf`|`false`|
|`send_report`| Send report.|``|`false`|

### Usage
```
curl -sSL https://raw.githubusercontent.com/cycloidio/cycloid-utils/master/report/generated/onprem_report.sh | sudo bash
```


## getreport.sh

This script is used to get the report generated by the previous scripts.
Customer need to provide the URL and secret generated.

**functions list**

  * Download report from the provided URL.
  * GPG Decrypt the archive with the provided secret.
  * Extract the archive in `/tmp/debug`.

### Usage

```
./getreport.sh <https_url> <secret>
```
